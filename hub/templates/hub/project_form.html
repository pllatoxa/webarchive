{% extends 'archive/base.html' %}
{% block title %}–°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–µ–∫—Ç{% endblock %}
{% block body_class %}project-form-page{% endblock %}

{% block content %}
<style>
/* ===== –ü—Ä–æ—Å—Ç–æ–π —Å–∫—Ä–æ–ª–ª–∏–Ω–≥ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ===== */
.project-form-page{
  overflow-y: auto !important;
  overflow-x: hidden !important;
  height: auto !important;
}

/* ===== –£–±–∏—Ä–∞–µ–º –ª—é–±—ã–µ —Ñ–∏–∫—Å-–≤—ã—Å–æ—Ç—ã/–æ–±—Ä–µ–∑–∞–Ω–∏—è (–µ—Å–ª–∏ –±—ã–ª–∏ —Ä–∞–Ω—å—à–µ) ===== */
.project-form-page .upload-page,
.project-form-page .project-create-grid,
.project-form-page .project-two-col,
.project-form-page .panel,
.project-form-page .project-main,
.project-form-page .project-readme{
  height: auto !important;
  max-height: none !important;
  overflow: visible !important;
}

/* ===== –ü–∞–Ω–µ–ª–∏ (–í–ê–ñ–ù–û: —Ç–µ–ø–µ—Ä—å —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–µ–º—ã) ===== */
.project-form-page .panel{
  border: 1px solid var(--border);
  border-radius: 16px;

  /* –±—ã–ª–æ rgba(10,14,22,0.72) -> –ª–æ–º–∞–ª–æ light —Ç–µ–º—É */
  background: var(--card);

  box-shadow: 0 10px 30px rgba(0,0,0,0.08);
  padding: 16px;
  box-sizing: border-box;

  transition: background-color .2s ease, border-color .2s ease;
}

.project-form-page .panel-header{
  padding: 0 0 12px 0;
}

/* –ª–µ–π–±–ª—ã/—Ç–µ–∫—Å—Ç —á—Ç–æ–±—ã –≤ light –Ω–µ ‚Äú–ø—Ä–æ–≤–∞–ª–∏–≤–∞–ª–∏—Å—å‚Äù */
.project-form-page .form-row label{
  display:block;
  margin-bottom: 6px;
  color: var(--text);
}
.project-form-page .meta{
  color: var(--muted);
}

/* –∫–æ–º–ø–∞–∫—Ç–Ω–µ–µ */
.project-form-page .form-row{ margin-bottom: 12px; }

/* ===== –î—Ä–æ–ø–∑–æ–Ω–∞ ZIP (—Ç–æ–∂–µ —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–µ–º—ã) ===== */
.project-form-page #attachment-dropzone{
  min-height: 120px;
  border-radius: 12px;
  cursor: pointer;
  user-select: none;

  display: flex;
  align-items: center;
  gap: 12px;

  border: 1px dashed var(--border);

  /* –±—ã–ª–æ rgba(255,255,255,0.03) -> –≤ light –≤—ã–≥–ª—è–¥–µ–ª–æ –≥—Ä—è–∑–Ω–æ */
  background: transparent;

  transition: background-color .2s ease, border-color .2s ease;
}

.project-form-page #attachment-dropzone:hover{
  border-color: var(--accent);
  background: var(--glass); /* –≤ dark: –±–µ–ª–∞—è –ª–µ–≥–∫–∞—è, –≤ light: —á–µ—Ä–Ω–∞—è –ª–µ–≥–∫–∞—è */
}

.project-form-page #attachment-dropzone.drag-over{
  outline: 2px dashed var(--accent);
  outline-offset: 2px;
}

.project-form-page .dropzone-icon{
  flex: 0 0 auto;
  font-size: 28px;
  line-height: 1;
  background: none;
  border: none;
}

/* input —Ñ–∞–π–ª–∞ –ø—Ä—è—á–µ–º */
.project-form-page .file-hidden-input{
  position: absolute !important;
  width: 1px !important;
  height: 1px !important;
  padding: 0 !important;
  margin: -1px !important;
  overflow: hidden !important;
  clip: rect(0,0,0,0) !important;
  white-space: nowrap !important;
  border: 0 !important;
}
</style>

<section class="upload-page project-create-grid">
  <header class="project-hero">
    <div class="hero-text">
      <p class="eyebrow">–ù–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç</p>
      <h1>–°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–µ–∫—Ç</h1>
    </div>
    <div class="hero-actions">
      <button form="project-create-form" type="submit" class="button primary">–°–æ–∑–¥–∞—Ç—å</button>
      <a href="{% url 'project_list' %}" class="button ghost">–û—Ç–º–µ–Ω–∞</a>
    </div>
  </header>

  <form id="project-create-form" method="post" enctype="multipart/form-data" class="project-two-col">
    {% csrf_token %}
    {{ form.non_field_errors }}
    {{ form.visibility.errors }}

    <div class="panel project-main">
      <div class="panel-header"></div>

      <div class="form-row">
        <label for="{{ form.title.id_for_label }}">–ù–∞–∑–≤–∞–Ω–∏–µ</label>
        {{ form.title }}
        {{ form.title.errors }}
      </div>

      <div class="form-row">
        <label for="{{ form.short_description.id_for_label }}">–û–ø–∏—Å–∞–Ω–∏–µ</label>
        {{ form.short_description }}
        {{ form.short_description.errors }}
      </div>

      <div class="form-row">
        <label for="{{ form.github_url.id_for_label }}">GitHub URL <span class="meta">(–µ—Å–ª–∏ –µ—Å—Ç—å)</span></label>
        {{ form.github_url }}
        {{ form.github_url.errors }}
      </div>

      {{ form.visibility }}
    </div>

    <div class="panel project-readme">
      <div class="panel-header">
        <h3>README</h3>
      </div>

      <div class="form-row">
        <label for="{{ form.readme.id_for_label }}">–°–æ–¥–µ—Ä–∂–∏–º–æ–µ</label>
        {{ form.readme }}
      </div>

      <div class="form-row">
        <label for="{{ form.attachment.id_for_label }}">ZIP —Ñ–∞–π–ª –ø—Ä–æ–µ–∫—Ç–∞</label>

        <div class="upload-dropzone avatar-dropzone" id="attachment-dropzone">
          <div class="dropzone-icon" aria-hidden="true">üìÅ</div>
          <div class="dropzone-text">
            <strong id="attachment-title">–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ .zip —Å—é–¥–∞</strong>
            <span class="meta" id="attachment-subtitle">–∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã –≤—ã–±—Ä–∞—Ç—å ZIP</span>
          </div>
        </div>

        {{ form.attachment }}
        {{ form.attachment.errors }}
      </div>
    </div>
  </form>
</section>

<script>
(function() {
  const dropzone = document.getElementById('attachment-dropzone');
  const input = document.getElementById('{{ form.attachment.id_for_label }}');
  const titleEl = document.getElementById('attachment-title');
  const subtitleEl = document.getElementById('attachment-subtitle');
  if (!dropzone || !input) return;

  input.setAttribute('accept', '.zip,application/zip');
  input.classList.add('file-hidden-input');

  function setFileLabel(file) {
    if (!titleEl || !subtitleEl) return;
    if (file) {
      titleEl.textContent = file.name;
      subtitleEl.textContent = '–ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã –∑–∞–º–µ–Ω–∏—Ç—å ZIP';
    } else {
      titleEl.textContent = '–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ .zip —Å—é–¥–∞';
      subtitleEl.textContent = '–∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã –≤—ã–±—Ä–∞—Ç—å ZIP';
    }
  }

  dropzone.addEventListener('click', () => input.click());
  input.addEventListener('change', () => {
    const file = input.files && input.files[0] ? input.files[0] : null;
    setFileLabel(file);
  });

  dropzone.addEventListener('dragover', (e) => { e.preventDefault(); dropzone.classList.add('drag-over'); });
  dropzone.addEventListener('dragleave', (e) => { e.preventDefault(); dropzone.classList.remove('drag-over'); });
  dropzone.addEventListener('drop', (e) => {
    e.preventDefault();
    dropzone.classList.remove('drag-over');
    if (e.dataTransfer.files && e.dataTransfer.files.length > 0) {
      input.files = e.dataTransfer.files;
      setFileLabel(e.dataTransfer.files[0]);
    }
  });
})();
</script>
{% endblock %}
